import{dT as r,dQ as t,e0 as e,X as n,Y as o,Z as a,cd as i,a1 as s,a9 as l,e1 as c,e2 as u,e3 as f,e4 as p,e5 as y,e6 as g,e7 as h,e8 as m,e9 as A,ea as d,eb as T,a6 as E,r as v,ec as F,ed as w,ee as M,n as x,ef as P,eg as R,eh as b,ei as N,ej as _,ek as j,el as z,em as B,dP as L,t as C,en as S,eo as Y,aH as V,ep as q,eq as I}from"./vendor.d9ce5f39.js";import{A as G,P as O,I as W,e as k,a as H}from"./quat.b9d69b87.js";import{e as Q,a as U,b as X,c as Z,f as D,o as J}from"./vec33.6044102f.js";import{T as K,i as $}from"./BufferView.77b40d9f.js";function rr(r=ar){return[r[0],r[1],r[2],r[3]]}function tr(t,e,n=rr()){return r(n,t),n[3]=e,n}function er(r,t,n=rr()){return G(ir,r,or(r)),G(sr,t,or(t)),O(ir,sr,ir),function(r,t){return r[3]=t,r}(n,e(W(n,ir)))}function nr(r){return r}function or(r){return t(r[3])}const ar=[0,0,1,0],ir=k(),sr=k();var lr;rr();let cr=lr=class extends i{constructor(r){super(r),this.origin=s(),this.translation=s(),this.rotation=rr(),this.scale=l(1,1,1),this.geographic=!0}get localMatrix(){const r=Q();return c(r,r,this.scale),u(r,r,or(this.rotation),this.rotation),f(r,r,this.translation),r}get localMatrixInverse(){return p(Q(),this.localMatrix)}applyLocal(r,t){return y(t,r,this.localMatrix)}applyLocalInverse(r,t){return y(t,r,this.localMatrixInverse)}project(r,t){const e=new Float64Array(r.length),n=K.fromTypedArray(e),o=K.fromTypedArray(r);if(this.geographic){const r=g(h(t)),a=Q();return m(t,this.origin,a,r),A(a,a,this.localMatrix),U(n,o,a),d(e,r,0,e,t,0,e.length/3),e}const{localMatrix:a,origin:i}=this;T(a,X)?Z(n,o):U(n,o,a);for(let s=0;s<e.length;s+=3)e[s+0]+=i[0],e[s+1]+=i[1],e[s+2]+=i[2];return e}getOriginPoint(r){const[t,e,n]=this.origin;return new E({x:t,y:e,z:n,spatialReference:r})}equals(r){return v(r)&&this.geographic===r.geographic&&F(this.origin,r.origin)&&w(this.localMatrix,r.localMatrix)}clone(){const r={origin:M(this.origin),translation:M(this.translation),rotation:rr(this.rotation),scale:M(this.scale),geographic:this.geographic};return new lr(r)}};n([o({type:[Number],nonNullable:!0,json:{write:!0}})],cr.prototype,"origin",void 0),n([o({type:[Number],nonNullable:!0,json:{write:!0}})],cr.prototype,"translation",void 0),n([o({type:[Number],nonNullable:!0,json:{write:!0}})],cr.prototype,"rotation",void 0),n([o({type:[Number],nonNullable:!0,json:{write:!0}})],cr.prototype,"scale",void 0),n([o({type:Boolean,nonNullable:!0,json:{write:!0}})],cr.prototype,"geographic",void 0),n([o()],cr.prototype,"localMatrix",null),n([o()],cr.prototype,"localMatrixInverse",null),cr=lr=n([a("esri.geometry.support.MeshTransform")],cr);var ur=cr;function fr(r,t){var e;return r.isGeographic||r.isWebMercator&&(null==(e=null==t?void 0:t.geographic)||e)}const pr=x.getLogger("esri.geometry.support.meshUtils.normalProjection");function yr(r,t,e,n,o){return wr(n)?(Fr(0,$.fromTypedArray(r),K.fromTypedArray(t),K.fromTypedArray(e),n,$.fromTypedArray(o)),o):(pr.error("Cannot convert spatial reference to PCPF"),o)}function gr(r,t,e,n,o){return wr(n)?(Fr(1,$.fromTypedArray(r),K.fromTypedArray(t),K.fromTypedArray(e),n,$.fromTypedArray(o)),o):(pr.error("Cannot convert to spatial reference from PCPF"),o)}function hr(r,t,e){return d(r,t,0,e,P(t),0,r.length/3),e}function mr(r,t,e){return d(r,P(e),0,t,e,0,r.length/3),t}function Ar(r,t,e){if(C(r))return t;const n=K.fromTypedArray(r),o=K.fromTypedArray(t);return U(o,n,e),t}function dr(r,t,e){if(C(r))return t;S(br,e);const n=$.fromTypedArray(r),o=$.fromTypedArray(t);return D(o,n,br),Y(br)||J(o,o),t}function Tr(r,t,e){if(C(r))return t;S(br,e);const n=$.fromTypedArray(r,4*Float32Array.BYTES_PER_ELEMENT),o=$.fromTypedArray(t,4*Float32Array.BYTES_PER_ELEMENT);if(D(o,n,br),Y(br)||J(o,o),r!==t)for(let a=3;a<r.length;a+=4)t[a]=r[a];return t}function Er(r,t,e,n,o){if(!wr(n))return pr.error("Cannot convert spatial reference to PCPF"),o;Fr(0,$.fromTypedArray(r,4*Float32Array.BYTES_PER_ELEMENT),K.fromTypedArray(t),K.fromTypedArray(e),n,$.fromTypedArray(o,4*Float32Array.BYTES_PER_ELEMENT));for(let a=3;a<r.length;a+=4)o[a]=r[a];return o}function vr(r,t,e,n,o){if(!wr(n))return pr.error("Cannot convert to spatial reference from PCPF"),o;Fr(1,$.fromTypedArray(r,16),K.fromTypedArray(t),K.fromTypedArray(e),n,$.fromTypedArray(o,16));for(let a=3;a<r.length;a+=4)o[a]=r[a];return o}function Fr(r,t,e,n,o,a){if(!t)return;const i=e.count,s=P(o);if(Mr(o))for(let l=0;l<i;l++)n.getVec(l,xr),t.getVec(l,Pr),m(s,xr,Rr,s),_(br,Rr),1===r&&j(br,br),z(Pr,Pr,br),a.setVec(l,Pr);else for(let l=0;l<i;l++){n.getVec(l,xr),t.getVec(l,Pr),m(s,xr,Rr,s),_(br,Rr);const o=B(e.get(l,1));let i=Math.cos(o);0===r&&(i=1/i),br[0]*=i,br[1]*=i,br[2]*=i,br[3]*=i,br[4]*=i,br[5]*=i,1===r&&j(br,br),z(Pr,Pr,br),L(Pr,Pr),a.setVec(l,Pr)}return a}function wr(r){return Mr(r)||function(r){return r.isWebMercator}(r)}function Mr(r){return r.isWGS84||R(r)||b(r)||N(r)}const xr=s(),Pr=s(),Rr=Q(),br=H();function Nr(r,t,e){return fr(t.spatialReference,e)?function(r,t,e){const n=t.spatialReference,o=Vr(t,e,Or),a=new Float64Array(r.position.length),i=function(r,t,e,n){U(K.fromTypedArray(n),K.fromTypedArray(r),t);const o=new Float64Array(r.length);return mr(n,o,e)}(r.position,o,n,a),s=S(kr,o);return{position:i,normal:Lr(i,a,r.normal,s,n),tangent:Cr(i,a,r.tangent,s,n)}}(r,t,e):function(r,t,e){const n=new Float64Array(r.position.length),o=r.position,a=t.x,i=t.y,s=t.z||0,{horizontal:l,vertical:c}=Gr(e?e.unit:null,t.spatialReference);for(let u=0;u<o.length;u+=3)n[u+0]=o[u+0]*l+a,n[u+1]=o[u+1]*l+i,n[u+2]=o[u+2]*c+s;return{position:n,normal:r.normal,tangent:r.tangent}}(r,t,e)}function _r(r,t,e){const{position:n,normal:o,tangent:a}=r;if(C(t))return{position:n,normal:o,tangent:a};const i=t.localMatrix;return Nr({position:Ar(n,new Float64Array(n.length),i),normal:v(o)?dr(o,new Float32Array(o.length),i):null,tangent:v(a)?Tr(a,new Float32Array(a.length),i):null},t.getOriginPoint(e),{geographic:t.geographic})}function jr(r,t,e){if(null!=e&&e.useTransform){var n;const{position:o,normal:a,tangent:i}=r;return{vertexAttributes:{position:o,normal:a,tangent:i},transform:new ur({origin:[t.x,t.y,null!=(n=t.z)?n:0],geographic:fr(t.spatialReference,e)})}}return{vertexAttributes:Nr(r,t,e),transform:null}}function zr(r,t,e){return fr(t.spatialReference,e)?Yr(r,t,e):Sr(r,t,e)}function Br(r,t,e,n){if(C(t))return zr(r,e,n);const o=_r(r,t,e.spatialReference);return e.equals(t.getOriginPoint(e.spatialReference))?Sr(o,e,n):fr(e.spatialReference,n)?Yr(o,e,n):Sr(o,e,n)}function Lr(r,t,e,n,o){if(C(e))return null;const a=new Float32Array(e.length);return D($.fromTypedArray(a),$.fromTypedArray(e),n),gr(a,r,t,o,a),a}function Cr(r,t,e,n,o){if(C(e))return null;const a=new Float32Array(e.length);D($.fromTypedArray(a,4*Float32Array.BYTES_PER_ELEMENT),$.fromTypedArray(e,4*Float32Array.BYTES_PER_ELEMENT),n);for(let i=3;i<a.length;i+=4)a[i]=e[i];return vr(a,r,t,o,a),a}function Sr(r,t,e){const n=new Float64Array(r.position.length),o=r.position,a=t.x,i=t.y,s=t.z||0,{horizontal:l,vertical:c}=Gr(e?e.unit:null,t.spatialReference);for(let u=0;u<o.length;u+=3)n[u+0]=(o[u+0]-a)/l,n[u+1]=(o[u+1]-i)/l,n[u+2]=(o[u+2]-s)/c;return{position:n,normal:r.normal,tangent:r.tangent}}function Yr(r,t,e){const n=t.spatialReference;Vr(t,e,Or);const o=p(Wr,Or),a=new Float64Array(r.position.length),i=function(r,t,e,n){const o=hr(r,t,n),a=K.fromTypedArray(o),i=new Float64Array(o.length),s=K.fromTypedArray(i);return U(s,a,e),i}(r.position,n,o,a),s=S(kr,o);return{position:i,normal:qr(r.normal,r.position,a,n,s),tangent:Ir(r.tangent,r.position,a,n,s)}}function Vr(r,t,e){m(r.spatialReference,[r.x,r.y,r.z||0],e,P(r.spatialReference));const{horizontal:n,vertical:o}=Gr(t?t.unit:null,r.spatialReference);return c(e,e,[n,n,o]),e}function qr(r,t,e,n,o){if(C(r))return null;const a=yr(r,t,e,n,new Float32Array(r.length)),i=$.fromTypedArray(a);return D(i,i,o),a}function Ir(r,t,e,n,o){if(C(r))return null;const a=Er(r,t,e,n,new Float32Array(r.length)),i=$.fromTypedArray(a,4*Float32Array.BYTES_PER_ELEMENT);return D(i,i,o),a}function Gr(r,t){if(C(r))return Hr;const e=t.isGeographic?1:V(t),n=t.isGeographic?1:q(t),o=I(1,r,"meters");return{horizontal:o*e,vertical:o*n}}const Or=Q(),Wr=Q(),kr=H(),Hr={horizontal:1,vertical:1};export{Er as B,yr as F,zr as M,ur as O,Br as P,vr as R,_r as _,mr as a,gr as b,rr as c,nr as d,or as e,tr as f,jr as k,er as q,fr as r,hr as v,Nr as x};
